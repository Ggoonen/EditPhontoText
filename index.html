<!DOCTYPE html>
<html>
<head>
<title>Ù…Ø­Ø±Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ - Ø¹Ø±Ø¶ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Changa:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lateef&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Reem+Kufi+Ink&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Katibeh&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Marhey&display=swap" rel="stylesheet">

<style>
  /*
  ** Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯Ø©: Ø­ÙŠÙˆÙŠØ© ÙˆÙ…Ø´Ø±Ù‚Ø©
  */
  :root {
    --primary-color: #5E35B1; /* Ø¨Ù†ÙØ³Ø¬ÙŠ ØºØ§Ù…Ù‚ Ø¬Ø°Ø§Ø¨ */
    --secondary-color: #FFC107; /* Ø£ØµÙØ± Ø°Ù‡Ø¨ÙŠ Ø³Ø§Ø·Ø¹ */
    --accent-color: #F44336; /* Ø£Ø­Ù…Ø± Ù†Ø§Ø¨Ø¶ Ø¨Ø§Ù„Ø­ÙŠØ§Ø© */
    --background-dark: #121212; /* Ø£Ø³ÙˆØ¯ Ø­Ø§Ù„Ùƒ Ù„Ù„Ø®Ù„ÙÙŠØ© */
    --card-background: #1E1E1E; /* Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙƒÙ† Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    --text-light: #E0E0E0; /* Ø£Ø¨ÙŠØ¶ Ø³Ø§Ø·Ø¹ Ù„Ù„Ù†Øµ */
    --text-muted: #B0B0B0; /* Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ Ù„Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ */
    --border-color: #333333; /* Ø­Ø¯ÙˆØ¯ Ø¯Ø§ÙƒÙ†Ø© */
    --input-background: #282828; /* Ø®Ù„ÙÙŠØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    --button-primary: #4CAF50; /* Ø£Ø®Ø¶Ø± Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    --button-hover: #43A047; /* Ø£Ø®Ø¶Ø± Ø£ØºÙ…Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
    --button-active: #388E3C; /* Ø£Ø®Ø¶Ø± Ø£ØºÙ…Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± */
    --shadow-light: rgba(0, 0, 0, 0.6); /* Ø¸Ù„ Ø®ÙÙŠÙ */
    --shadow-dark: rgba(0, 0, 0, 0.8); /* Ø¸Ù„ Ø£ØºÙ…Ù‚ */

    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Toggle) */
    --toggle-off-bg: #555;
    --toggle-on-bg: var(--button-primary);

    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
    --notification-success: #4CAF50;
    --notification-error: #F44336;
    --notification-info: #2196F3;
  }

  /*
  ** ØªØ­Ø¯ÙŠØ«Ø§Øª Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø³Ù„Ø§Ø³Ø© ÙˆØ§Ù„ØªÙ…Ø±ÙŠØ± ÙˆØ§Ù„ØµÙˆØ±Ø©
  */

  /* ØªØ·Ø¨ÙŠÙ‚ box-sizing Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  html {
    height: 100%; /* ØªØ£ÙƒØ¯ Ø£Ù† html ÙŠØºØ·ÙŠ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
    scroll-behavior: smooth; /* ØªÙ…Ø±ÙŠØ± Ø³Ù„Ø³ */
  }

  body {
    margin: 0;
    padding: 20px;
    height: 100%; /* ØªØ£ÙƒØ¯ Ø£Ù† body ÙŠØºØ·ÙŠ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
    width: 100vw;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: linear-gradient(135deg, var(--background-dark), #000000); /* ØªØ¯Ø±Ø¬ Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ† */
    color: var(--text-light);
    overflow-y: auto; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© */
    -webkit-overflow-scrolling: touch; /* Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù„Ù‰ iOS */
  }

  .container {
    width: 100%;
    max-width: 380px;
    background-color: var(--card-background);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px var(--shadow-dark); /* Ø¸Ù„ Ø£ØºÙ…Ù‚ ÙˆØ¬Ø°Ø§Ø¨ */
    margin-bottom: 30px;
    border: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    position: relative;
    flex-shrink: 0; /* Ù…Ù‡Ù…: Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´ Ø¹Ù†Ø¯ ØªÙˆÙØ± Ù…Ø³Ø§Ø­Ø© Ø£Ù‚Ù„ */
    transition: transform 0.3s ease, box-shadow 0.3s ease; /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ */
  }
  .container:hover {
      transform: translateY(-5px); /* Ø±ÙØ¹ Ø®ÙÙŠÙ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
      box-shadow: 0 12px 30px var(--shadow-dark);
  }

  .image-area {
    width: 100%;
    padding-bottom: 100%; /* Ù†Ø³Ø¨Ø© 1:1 Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ù…Ø±Ø¨Ø¹Ø© */
    position: relative; /* Ù„ØªÙ…ÙƒÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„Ù‚ */
    background-color: var(--input-background); /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© ÙŠØ¸Ù‡Ø± Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© */
    border-radius: 12px 12px 0 0;
    overflow: hidden; /* Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© ÙˆÙ‚Øµ Ø§Ù„Ø²ÙˆØ§Ø¦Ø¯ */
  }

  .editable-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover; /* Ù…Ù‡Ù…: ÙŠØ¬Ø¹Ù„ Ø§Ù„ØµÙˆØ±Ø© ØªÙ…Ù„Ø£ Ø§Ù„Ø­Ø§ÙˆÙŠØ© ÙˆØªÙ‚Øµ Ø§Ù„Ø²ÙˆØ§Ø¦Ø¯ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹ */
    transition: transform 0.3s ease;
  }
  .editable-image:hover {
      transform: scale(1.05); /* ØªÙƒØ¨ÙŠØ± Ø®ÙÙŠÙ Ù„Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
  }


  .red-fixed-area {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    color: var(--text-light);
    direction: rtl;
    font-size: 1.1em;
    font-weight: 700;
    text-shadow: 1px 1px 3px var(--shadow-light);
    z-index: 1;
    border-radius: 0 0 12px 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 18px 25px;
    min-height: 75px;
    transform: translateY(0.5px);
    gap: 10px;
    background: linear-gradient(to right, var(--accent-color), #D32F2F); /* ØªØ¯Ø±Ø¬ Ø¬Ø°Ø§Ø¨ Ù„Ù„Ø´Ø±ÙŠØ· */
    transition: background 0.3s ease, min-height 0.3s ease, padding 0.3s ease; /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª */
  }

  /* Ø£Ø´ÙƒØ§Ù„ Ø­ÙˆØ§Ù Ø§Ù„Ø´Ø±ÙŠØ· */
  .red-fixed-area.rounded-bottom-banner {
    border-bottom-left-radius: 15px;
    border-bottom-right-radius: 15px;
  }


  #channelIconsContainer {
    display: flex;
    align-items: center;
    gap: 5px;
    order: 1;
  }
  #channelIconsContainer img {
      max-width: 100%;
      max-height: 100%;
      height: auto;
      display: block;
      object-fit: contain;
  }
  #channelIconsContainer span {
      line-height: 1;
  }

  .editable-text {
    font-size: 1em;
    margin: 0;
    line-height: 1.4;
    text-align: center;
    width: 100%;
    word-wrap: break-word;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    order: 2;
  }

  .controls {
    width: 100%;
    max-width: 450px;
    background-color: var(--card-background);
    border-radius: 12px;
    box-shadow: 0 8px 25px var(--shadow-dark); /* Ø¸Ù„ Ø£ØºÙ…Ù‚ ÙˆØ¬Ø°Ø§Ø¨ */
    border: 1px solid var(--border-color);
    overflow: hidden;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    margin-top: auto;
    margin-bottom: 20px;
    flex-shrink: 0; /* Ù…Ù‡Ù…: Ù„Ù…Ù†Ø¹ Ø§Ù†ÙƒÙ…Ø§Ø´ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± */
    transition: transform 0.3s ease, box-shadow 0.3s ease; /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ */
  }
  .controls:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px var(--shadow-dark);
  }

  .tab-buttons {
    display: flex;
    width: 100%;
    background-color: var(--input-background); /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø£ØºÙ…Ù‚ Ù„Ù„ØªØ§Ø¨Ø§Øª */
    border-bottom: 1px solid var(--border-color);
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
  }

  .tab-button {
    flex-shrink: 0;
    padding: 16px 10px;
    text-align: center;
    cursor: pointer;
    background-color: var(--input-background); /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø£ØºÙ…Ù‚ Ù„Ù„ØªØ§Ø¨Ø§Øª */
    color: var(--text-muted);
    font-weight: 700;
    font-size: 0.95em;
    border: none;
    border-left: 1px solid var(--border-color);
    transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .tab-button:first-child {
      border-left: none;
  }

  .tab-button:hover {
    background-color: #383838; /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
    color: var(--text-light);
  }

  .tab-button.active {
    background-color: var(--card-background); /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„ØªØ§Ø¨ Ø§Ù„Ù†Ø´Ø· */
    color: var(--accent-color);
    box-shadow: inset 0 3px 0 0 var(--accent-color);
    border-bottom-color: var(--card-background);
  }

  .tab-content {
    padding: 25px;
    display: none;
    flex-direction: column;
    gap: 20px;
  }

  .tab-content.active {
    display: flex;
  }

  .control-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .control-group label {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
    font-weight: 400;
    color: var(--text-muted);
    font-size: 1em;
  }

  .control-group label .icon {
    margin-left: 8px;
    font-size: 1.3em;
    color: var(--secondary-color); /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù„ÙˆÙ† Ø£ØµÙØ± */
  }

  /* ØªØµÙ…ÙŠÙ… Ø¹Ø§Ù… Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
  .controls input[type="text"],
  .controls textarea,
  .controls select,
  .controls input[type="color"],
  .controls input[type="range"] {
    width: 100%; /* Ø§Ø³ØªØ®Ø¯Ø§Ù… 100% Ø«Ù… Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Øº Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.95em;
    background-color: var(--input-background);
    color: var(--text-light);
    transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
  }

  /* ØªØ®ØµÙŠØµ Select */
  .controls select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23E0E0E0" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
    background-repeat: no-repeat;
    background-position: left 12px center;
    padding-left: 40px;
  }

  /* ØªØ®ØµÙŠØµ Color Picker */
  .controls input[type="color"] {
    padding: 5px;
    height: 48px;
    width: 60px;
    border-radius: 8px;
    cursor: pointer;
    border: none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù€ color picker */
  }

  /* Placeholder color */
  .controls input::placeholder,
  .controls textarea::placeholder {
    color: var(--text-muted);
    opacity: 0.8;
  }

  .controls input[type="text"]:focus,
  .controls textarea:focus,
  .controls select:focus,
  .controls input[type="color"]:focus,
  .controls input[type="range"]:focus {
    border-color: var(--secondary-color); /* Ù„ÙˆÙ† Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    box-shadow: 0 0 0 4px rgba(255, 193, 7, 0.2); /* Ø¸Ù„ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    outline: none;
    background-color: #383838;
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨Ù€ textarea - Ø¬Ø¹Ù„Ù‡Ø§ Ø£ÙƒØ¨Ø± */
  .controls textarea {
    resize: vertical;
    min-height: 120px;
    line-height: 1.5;
  }

  /* ØªØµÙ…ÙŠÙ… Ø£ÙØ¶Ù„ Ù„Ø²Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù */
  .file-input-wrapper {
    position: relative;
    display: inline-block;
    width: 100%;
  }

  .file-input-button {
    background-color: var(--button-primary); /* Ù„ÙˆÙ† Ø²Ø± Ø£Ø³Ø§Ø³ÙŠ */
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 700;
    width: 100%;
    box-sizing: border-box;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.3); /* Ø¸Ù„ Ù…Ø¹Ø²Ø² */
  }

  .file-input-button .icon {
    font-size: 1.2em;
  }

  .file-input-button:hover {
    background-color: var(--button-hover);
    transform: translateY(-2px);
    box-shadow: 0 5px 12px rgba(0,0,0,0.45);
  }
  .file-input-button:active {
    transform: translateY(0);
    background-color: var(--button-active);
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }

  /* Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
  .controls input[type="file"] {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
    z-index: 10;
  }

  /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø±Ù ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª */
  .text-info {
    display: flex;
    justify-content: space-between;
    font-size: 0.85em;
    color: var(--text-muted);
    margin-top: 5px;
    direction: rtl;
    width: 100%;
  }
  .char-count.warning, .word-count.warning {
    color: var(--secondary-color); /* ØªØ­Ø°ÙŠØ± Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£ØµÙØ± */
  }
  .char-count.danger, .word-count.danger {
    color: var(--accent-color); /* Ø®Ø·Ø± Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± */
  }

  /* Ø¥Ø¶Ø§ÙØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Toggle Switch) Ù„Ø¸Ù„ Ø§Ù„Ù†Øµ */
  .toggle-switch-group {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    width: 100%;
  }

  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  }

  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--toggle-off-bg);
    transition: .4s;
    border-radius: 34px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: var(--toggle-on-bg);
  }

  input:focus + .slider {
    box-shadow: 0 0 1px var(--toggle-on-bg);
  }

  input:checked + .slider:before {
    transform: translateX(26px);
  }

  /* Ø£Ø²Ø±Ø§Ø± Ø¹Ø±Ø¶ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø© */
  .screenshot-buttons {
    display: flex;
    gap: 15px;
    margin-top: 25px;
  }
  .screenshot-buttons button {
    flex: 1;
    padding: 15px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: 700;
    box-sizing: border-box;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.3);
  }

  #viewScreenshotBtn {
    background-color: var(--primary-color); /* Ù„ÙˆÙ† Ø¨Ù†ÙØ³Ø¬ÙŠ Ø¬Ø°Ø§Ø¨ */
    color: white;
  }
  #viewScreenshotBtn:hover {
    background-color: #673AB7; /* Ø¨Ù†ÙØ³Ø¬ÙŠ Ø£ØºÙ…Ù‚ */
    transform: translateY(-2px);
    box-shadow: 0 5px 12px rgba(0,0,0,0.45);
  }
  #viewScreenshotBtn:active {
    transform: translateY(0);
    background-color: #512DA8;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }


  .info-note {
    font-size: 0.9em;
    text-align: center;
    margin-top: 20px;
    border-radius: 10px;
    padding: 15px;
    line-height: 1.5;
    border: 1px solid var(--border-color);
    background-color: rgba(74, 74, 106, 0.15); /* Ù„ÙˆÙ† Ø´ÙØ§Ù */
    color: var(--text-muted);
  }

  /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰ */
  .player-stats {
    display: flex;
    justify-content: space-around;
    padding: 15px;
    background-color: var(--background-dark); /* Ù„ÙˆÙ† Ø¯Ø§ÙƒÙ† Ù„Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
    border-bottom: 1px solid var(--border-color);
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    font-weight: 700;
    font-size: 1em;
    color: var(--secondary-color); /* Ù„ÙˆÙ† Ø£ØµÙØ± Ù„Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
  }
  .player-stats div {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .player-stats div span {
      color: var(--text-light);
      margin-top: 3px;
      font-size: 0.8em;
  }
  .player-stats .main-value {
    font-size: 1.3em;
    color: var(--secondary-color);
  }
  .player-stats .secondary-value {
    font-size: 0.7em;
    color: var(--text-muted);
    margin-top: 2px;
  }


  /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø± */
  .store-section {
    margin-bottom: 25px;
  }
  .store-section h3 {
    color: var(--secondary-color); /* Ù„ÙˆÙ† Ø£ØµÙØ± Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
    margin-bottom: 12px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 5px;
    text-align: right;
    font-size: 1.2em;
  }
  .store-items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
    direction: rtl;
  }
  .store-item {
    background-color: var(--input-background); /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¬Ø± */
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    position: relative;
    overflow: hidden;
  }
  .store-item.locked {
    background-color: #222; /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ù‚ÙÙ„Ø© */
    filter: grayscale(80%) brightness(50%);
    cursor: not-allowed;
  }
  .store-item.unlocked .buy-button {
      background-color: var(--button-hover); /* Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ù„Ø²Ø± "ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡" */
      cursor: default;
  }
  .store-item.unlocked .buy-button:hover {
      background-color: var(--button-hover);
      transform: none;
      box-shadow: none;
  }


  .store-item:not(.locked):hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 12px rgba(0,0,0,0.3);
  }
  .store-item-name {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1em;
    color: var(--text-light);
  }
  .store-item-preview {
    margin-bottom: 12px;
    font-size: 2em;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    overflow: hidden;
  }
  /* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªØ¯Ø±Ø¬Ø§Øª */
  .store-item-preview.color-preview {
      height: 25px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
  }
  .store-item-preview.banner-preview {
      height: 40px;
      width: 100%;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.8em;
      color: white;
  }
  .store-item-preview.banner-preview.rounded-bottom-banner-preview {
      border-bottom-left-radius: 12px;
      border-bottom-right-radius: 12px;
  }
  .store-item-preview.text-effect-preview {
    font-size: 1.2em;
    color: var(--text-light);
    text-shadow: none;
    -webkit-text-stroke: none;
  }


  .store-item-details {
    font-size: 0.8em;
    color: var(--text-muted);
    margin-bottom: 12px;
    line-height: 1.3;
  }
  .store-item-details span {
    display: block;
  }
  .buy-button {
    background-color: var(--button-primary); /* Ù„ÙˆÙ† Ø²Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
    color: white;
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.2s ease;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }
  .buy-button:hover:not(:disabled) {
    background-color: var(--button-hover);
  }
  .buy-button:disabled {
    background-color: var(--toggle-off-bg); /* Ù„ÙˆÙ† Ø²Ø± Ù…Ø¹Ø·Ù„ */
    color: var(--text-muted);
    cursor: not-allowed;
  }
  .locked-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 1em;
      font-weight: 700;
      pointer-events: none;
      z-index: 10;
      border-radius: 8px;
  }
  .locked-overlay span {
      margin-top: 8px;
      font-size: 0.7em;
      font-weight: 400;
      color: var(--text-muted);
  }

  /* Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
  #notificationArea {
    position: fixed;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 90%;
    max-width: 320px;
  }
  .notification {
    background-color: var(--notification-info);
    color: var(--text-light);
    padding: 12px 15px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    text-align: center;
    font-size: 0.9em;
    opacity: 0;
    transform: translateY(-15px);
    transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ø¸Ù‡ÙˆØ± */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .notification.show {
    opacity: 1;
    transform: translateY(0);
  }
  .notification.success {
    background-color: var(--notification-success);
  }
  .notification.error {
    background-color: var(--notification-error);
  }
  .notification .icon {
      font-size: 1.1em;
  }

  /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¬Ø¯ÙŠØ¯ "ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¯Ù… Ù‚Ø±ÙŠØ¨Ø§" */
  #updateNotification {
    position: sticky;
    bottom: 10px;
    margin-top: auto;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    font-size: 0.85em;
    z-index: 1000;
    white-space: nowrap;
  }

  /* Media Queries Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„ÙƒØ¨ÙŠØ±Ø© */
  @media (max-width: 480px) {
    body {
      padding: 15px;
    }
    .controls {
      border-radius: 0;
    }
    .tab-buttons {
      border-top-left-radius: 0;
      border-top-right-radius: 0;
    }
    .container {
      border-radius: 0;
    }
    .image-area {
      border-radius: 0;
    }
    .red-fixed-area {
      border-radius: 0;
    }
  }

  @media (min-width: 768px) {
    body {
      padding: 30px;
    }
    .container {
      max-width: 450px;
      margin-bottom: 40px;
    }
    .controls {
      max-width: 550px;
      margin-bottom: 30px;
    }
    .tab-button {
      padding: 18px 15px;
      font-size: 1em;
    }
    .tab-content {
      padding: 30px;
      gap: 25px;
    }
    .file-input-button,
    .screenshot-buttons button {
      padding: 15px 25px;
      font-size: 1.1em;
    }
    .info-note {
      font-size: 1em;
      padding: 18px;
    }
  }

</style>
</head>
<body>

<div class="container" id="captureArea">
  <div class="image-area">
    <img id="mainImage" class="editable-image" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø®Ø¨Ø±">
  </div>
  <div class="red-fixed-area" id="redBanner">
    <div id="channelIconsContainer"></div>
    <p id="mainText" class="editable-text">
      Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡)
    </p>
  </div>
</div>

<div class="controls">
  <div class="player-stats">
    <div>
      <div class="main-value" id="dinarDisplay">0</div>
      <span>Ø¯ÙŠÙ†Ø§Ø±</span>
    </div>
    <div>
      <div class="main-value" id="levelDisplay">1</div>
      <span>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</span>
      <div class="secondary-value" id="xpRemainingDisplay">0 / 0 XP</div>
    </div>
  </div>

  <div class="tab-buttons" id="tabButtons">
    <button class="tab-button active" data-tab="image">
      <span class="icon">ğŸ–¼ï¸</span> Ø§Ù„ØµÙˆØ±Ø©
    </button>
    <button class="tab-button" data-tab="mainText">
      <span class="icon">ğŸ“</span> Ø§Ù„Ù†Øµ
    </button>
    <button class="tab-button" data-tab="redBanner">
      <span class="icon">ğŸ”´</span> Ø§Ù„Ø´Ø±ÙŠØ·
    </button>
    <button class="tab-button" data-tab="channelIcon">
      <span class="icon">âœ¨</span> Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
    </button>
    <button class="tab-button" data-tab="store">
      <span class="icon">ğŸ›’</span> Ø§Ù„Ù…ØªØ¬Ø±
    </button>
  </div>

  <div id="imageTabContent" class="tab-content active">
    <div class="control-group">
      <label for="imageUpload">
        <span class="icon">â¬†ï¸</span> ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©:
      </label>
      <div class="file-input-wrapper">
        <input type="file" id="imageUpload" accept="image/*">
        <button type="button" class="file-input-button">
          <span class="icon">ğŸ“‚</span> Ø§Ø®ØªØ± ØµÙˆØ±Ø©
        </button>
      </div>
      <small style="color: var(--text-muted);">Ø³ØªØ£ØªÙŠ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±Ø¨Ø¹Ø© Ù…Ø¹ Ø§Ù„Ù‚Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</small>
    </div>
  </div>

  <div id="mainTextTabContent" class="tab-content">
    <div class="control-group">
      <label for="newText">
        <span class="icon">ğŸ–Šï¸</span> Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§:
      </label>
      <textarea id="newText" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø®Ø¨Ø± Ù‡Ù†Ø§..."></textarea>
      <div class="text-info">
        <div id="charCount" class="char-count"></div>
        <div id="wordCount" class="word-count"></div>
      </div>
    </div>

    <div class="control-group">
      <label for="fontSelect">
          <span class="icon">ğŸ…°ï¸</span> Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·:
      </label>
      <select id="fontSelect">
          </select>
    </div>

    <div class="control-group">
      <label for="fontSize">
          <span class="icon">ğŸ“</span> Ø­Ø¬Ù… Ø§Ù„Ø®Ø·:
      </label>
      <input type="range" id="fontSize" min="0.8" max="1.8" step="0.1" value="1.1">
      <span id="fontSizeValue" style="color: var(--text-muted); text-align: left;">1.1em</span>
    </div>

    <div class="control-group">
      <label for="textColor">
          <span class="icon">ğŸ¨</span> Ù„ÙˆÙ† Ø§Ù„Ù†Øµ:
      </label>
      <input type="color" id="textColor" value="#ffffff">
    </div>

    <div class="control-group">
        <label for="textEffectSelect">
            <span class="icon">âœ¨</span> ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Øµ:
        </label>
        <select id="textEffectSelect">
            <option value="none" data-is-free="true">Ù„Ø§ Ø´ÙŠØ¡</option>
            </select>
    </div>

    <div class="control-group toggle-switch-group">
      <label for="textShadowToggle">
          <span class="icon">âš«</span> Ø¸Ù„ Ø§Ù„Ù†Øµ:
      </label>
      <label class="toggle-switch">
          <input type="checkbox" id="textShadowToggle" checked>
          <span class="slider"></span>
      </label>
    </div>
  </div>

  <div id="redBannerTabContent" class="tab-content">
    <div class="control-group">
        <label for="bannerStyleSelect">
            <span class="icon">ğŸ¨</span> Ù†Ù…Ø· Ø§Ù„Ø´Ø±ÙŠØ·:
        </label>
        <select id="bannerStyleSelect">
            <option value="default_red" data-is-free="true">Ø£Ø­Ù…Ø± (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
        </select>
    </div>
    <div class="control-group" id="redBannerColorInputGroup">
        <label for="redBannerColor">
            <span class="icon">ğŸŒˆ</span> Ù„ÙˆÙ† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ù…Ø± (ØªØ¹Ø¯ÙŠÙ„):
        </label>
        <input type="color" id="redBannerColor" value="#F44336">
    </div>
    <div class="control-group">
      <label for="bannerHeight">
          <span class="icon">ğŸ“</span> Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø±ÙŠØ·:
      </label>
      <input type="range" id="bannerHeight" min="60" max="120" step="5" value="75">
      <span id="bannerHeightValue" style="color: var(--text-muted); text-align: left;">75px</span>
    </div>

    <div class="control-group">
      <label for="textPadding">
          <span class="icon">â†”ï¸</span> Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¨Ø§Ø¯Ø¦Ø© Ù„Ù„Ù†Øµ:
      </label>
      <input type="range" id="textPadding" min="10" max="40" step="1" value="25">
      <span id="textPaddingValue" style="color: var(--text-muted); text-align: left;">25px</span>
    </div>
  </div>

  <div id="channelIconTabContent" class="tab-content">
    <div class="control-group">
        <label>
            <span class="icon">ğŸ–¼ï¸</span> Ù†ÙˆØ¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©:
        </label>
        <select id="iconTypeSelect">
            <option value="none" data-is-free="true">Ù„Ø§ Ø´ÙŠØ¡</option>
            </select>
    </div>

    <div class="control-group" id="customIconUploadGroup" style="display: none;">
        <label for="customIconUpload">
            <span class="icon">â¬†ï¸</span> ØªØ­Ù…ÙŠÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø®ØµØµØ©:
        </label>
        <div class="file-input-wrapper">
            <input type="file" id="customIconUpload" accept="image/*">
            <button type="button" class="file-input-button">
                <span class="icon">ğŸ“‚</span> Ø§Ø®ØªØ± Ø£ÙŠÙ‚ÙˆÙ†Ø©
            </button>
        </div>
        <small style="color: var(--text-muted);">ÙŠÙØ¶Ù„ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø±Ø¨Ø¹Ø© ÙˆØ´ÙØ§ÙØ©</small>
        <button type="button" class="file-input-button" id="removeCustomIconButton" style="background-color: var(--accent-color); margin-top: 10px;">
            <span class="icon">ğŸ—‘ï¸</span> Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø®ØµØµØ©
        </button>
    </div>

    <div class="control-group" id="iconColorAndSizeGroup">
        <label for="iconColor">
            <span class="icon">ğŸ¨</span> Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©:
        </label>
        <input type="color" id="iconColor" value="#FFFFFF">
    </div>

    <div class="control-group" id="iconSizeGroup">
        <label for="iconSize">
            <span class="icon">ğŸ”</span> Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©:
        </label>
        <input type="range" id="iconSize" min="1" max="2.5" step="0.1" value="1.5">
        <span id="iconSizeValue" style="color: var(--text-muted); text-align: left;">1.5em</span>
    </div>

    <div class="control-group">
        <label for="iconPosition">
            <span class="icon">â†”ï¸</span> Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©:
        </label>
        <select id="iconPosition">
            <option value="flex-start">ÙŠÙ…ÙŠÙ† (RTL)</option>
            <option value="center">Ø§Ù„Ù…Ù†ØªØµÙ</option>
            <option value="flex-end">ÙŠØ³Ø§Ø± (RTL)</option>
        </select>
    </div>
  </div>

  <div id="storeTabContent" class="tab-content">
    <div class="store-section">
        <h3>Ø§Ù„Ø®Ø·ÙˆØ·</h3>
        <div class="store-items-grid" id="storeFontsGrid">
            </div>
    </div>
    <div class="store-section">
        <h3>Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙŠØ· ÙˆØ£Ù†Ù…Ø§Ø·Ù‡</h3>
        <div class="store-items-grid" id="storeBannerStylesGrid">
            </div>
    </div>
    <div class="store-section">
        <h3>ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ</h3>
        <div class="store-items-grid" id="storeTextEffectsGrid">
            </div>
    </div>
    <div class="store-section">
        <h3>Ø£Ø­Ø¬Ø§Ù… ÙˆØªØ¹Ø¯ÙŠÙ„Ø§Øª</h3>
        <div class="store-items-grid" id="storeSizesGrid">
            </div>
    </div>
    <div class="store-section">
        <h3>Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h3>
        <div class="store-items-grid" id="storeIconsGrid">
            </div>
    </div>
  </div>


  <div class="screenshot-buttons">
    <button id="viewScreenshotBtn">
      <span class="icon">ğŸ“¸</span> Ø¹Ø±Ø¶ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©
    </button>
  </div>

  <div class="info-note">
    Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ØµÙ…Ù… Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø³Ù„Ø§Ø³Ø© ÙÙŠ Ø£ÙŠ Ù…ØªØµÙØ­ Ø­Ø¯ÙŠØ« (Ù…Ø«Ù„ ChromeØŒ SafariØŒ Firefox) Ø¹Ù„Ù‰ Ø£ÙŠ Ø¬Ù‡Ø§Ø²ØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ù‡Ø§ØªÙ Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬ A55.
  </div>
</div>

<div id="updateNotification">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¯Ù… Ù‚Ø±ÙŠØ¨Ø§</div>

<div id="notificationArea"></div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
  const mainImage = document.getElementById('mainImage');
  const mainText = document.getElementById('mainText');
  const imageUploadInput = document.getElementById('imageUpload');
  const newTextInput = document.getElementById('newText');
  const charCountDisplay = document.getElementById('charCount');
  const wordCountDisplay = document.getElementById('wordCount');
  const fontSelect = document.getElementById('fontSelect');
  const fontSizeInput = document.getElementById('fontSize');
  const fontSizeValueDisplay = document.getElementById('fontSizeValue');
  const textColorInput = document.getElementById('textColor');
  const redBannerColorInput = document.getElementById('redBannerColor');
  const redBanner = document.getElementById('redBanner');
  const textShadowToggle = document.getElementById('textShadowToggle');
  const viewScreenshotBtn = document.getElementById('viewScreenshotBtn');
  const captureArea = document.getElementById('captureArea');
  const textEffectSelect = document.getElementById('textEffectSelect'); // Ø¬Ø¯ÙŠØ¯ Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ

  // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
  const iconTypeSelect = document.getElementById('iconTypeSelect');
  const customIconUploadGroup = document.getElementById('customIconUploadGroup');
  const customIconUploadInput = document.getElementById('customIconUpload');
  const removeCustomIconButton = document.getElementById('removeCustomIconButton');
  const iconColorAndSizeGroup = document.getElementById('iconColorAndSizeGroup');
  const iconSizeGroup = document.getElementById('iconSizeGroup');
  const iconColorInput = document.getElementById('iconColor');
  const iconSizeInput = document.getElementById('iconSize');
  const iconSizeValueDisplay = document.getElementById('iconSizeValue');
  const iconPositionSelect = document.getElementById('iconPosition');
  const channelIconsContainer = document.getElementById('channelIconsContainer');

  // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ù…Ø±
  const bannerHeightInput = document.getElementById('bannerHeight');
  const bannerHeightValueDisplay = document.getElementById('bannerHeightValue');
  const textPaddingInput = document.getElementById('textPadding');
  const textPaddingValueDisplay = document.getElementById('textPaddingValue');
  const bannerStyleSelect = document.getElementById('bannerStyleSelect'); // Ø¬Ø¯ÙŠØ¯ Ù„Ù†Ù…Ø· Ø§Ù„Ø´Ø±ÙŠØ·

  // Ø¹Ù†Ø§ØµØ± Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰
  const dinarDisplay = document.getElementById('dinarDisplay');
  const levelDisplay = document.getElementById('levelDisplay');
  const xpRemainingDisplay = document.getElementById('xpRemainingDisplay');

  let totalDinar = parseInt(localStorage.getItem('totalDinar') || '0');
  let currentXP = parseInt(localStorage.getItem('currentXP') || '0');
  let currentLevel = parseInt(localStorage.getItem('currentLevel') || '1');
  let selectedBannerStyle = localStorage.getItem('selectedBannerStyle') || 'default_red'; // Ù„Ø­ÙØ¸ Ù†Ù…Ø· Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø®ØªØ§Ø±
  let selectedTextEffect = localStorage.getItem('selectedTextEffect') || 'none'; // Ù„Ø­ÙØ¸ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ØªØ§Ø±


  const XP_TO_LEVEL_UP_BASE = 5000; // XP Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰

  // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ¬Ø±
  const storeFontsGrid = document.getElementById('storeFontsGrid');
  const storeBannerStylesGrid = document.getElementById('storeBannerStylesGrid'); // Ø´Ø¨ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø±ÙŠØ·
  const storeTextEffectsGrid = document.getElementById('storeTextEffectsGrid'); // Ø´Ø¨ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ
  const storeSizesGrid = document.getElementById('storeSizesGrid');
  const storeIconsGrid = document.getElementById('storeIconsGrid');
  let unlockedItems = JSON.parse(localStorage.getItem('unlockedItems') || '[]');

  // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
  const notificationArea = document.getElementById('notificationArea');


  let customIconBase64 = localStorage.getItem('customIconBase64') || null; // Ù„ØªØ®Ø²ÙŠÙ† ØµÙˆØ±Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø®ØµØµØ©
  if (customIconBase64 && !isItemUnlocked('icon-custom')) { // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ ØµÙˆØ±Ø© Ù…Ø®ØµØµØ© Ù…Ø­ÙÙˆØ¸Ø© Ù„ÙƒÙ† Ø§Ù„Ø¹Ù†ØµØ± ØºÙŠØ± Ù…ÙØªÙˆØ­
      customIconBase64 = null; // Ù„Ø§ ØªØ³Ù…Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§
      localStorage.removeItem('customIconBase64');
  }


  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');

  const defaultText = "ØªØ±Ø§Ù…Ø¨: Ø¨Ø§Ø±ÙƒØª Ù„Ø£Ø±Ø¯ÙˆØºØ§Ù† ÙˆÙ‚Ù„Øª Ù„Ù‡ Ù„Ù‚Ø¯ Ø³ÙŠØ·Ø±ØªÙ… Ø¹Ù„Ù‰ Ø³ÙˆØ±ÙŠØ§";
  const maxCharLength = 150;

  mainText.innerHTML = defaultText;
  newTextInput.value = defaultText;

  // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø£Ùˆ Ù…Ø³Ø§Ø­Ø© Ø¨ÙŠØ¶Ø§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©
  mainImage.src = localStorage.getItem('mainImageSrc') || "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";


  // --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± ---
  const storeItemsData = [
    // Ø§Ù„Ø®Ø·ÙˆØ· (Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ù…Ø¬Ø§Ù†ÙŠ Ø§Ù„Ø¢Ù†)
    { id: 'font-changa', type: 'font', name: 'Ø´Ø§Ù†Ø¬Ø§ (Changa)', cost: 400, levelRequired: 2, value: 'Changa', style: 'font-family: \'Changa\', sans-serif;' },
    { id: 'font-almarai', type: 'font', name: 'Ø§Ù„Ù…Ø±Ø§Ø¹ÙŠ (Almarai)', cost: 500, levelRequired: 3, value: 'Almarai', style: 'font-family: \'Almarai\', sans-serif;' },
    { id: 'font-notosansarabic', type: 'font', name: 'Ù†ÙˆØªÙˆ Ø³Ø§Ù†Ø³ Ø¹Ø±Ø¨ÙŠ (Noto Sans Arabic)', cost: 600, levelRequired: 3, value: 'Noto Sans Arabic', style: 'font-family: \'Noto Sans Arabic\', sans-serif;' },
    { id: 'font-tajawal', type: 'font', name: 'ØªØ¬ÙˆØ§Ù„ (Tajawal)', cost: 700, levelRequired: 4, value: 'Tajawal', style: 'font-family: \'Tajawal\', sans-serif;' },
    { id: 'font-amiriquiran', type: 'font', name: 'Ø§Ù„ÙƒÙˆÙÙŠ (Amiri Quran)', cost: 800, levelRequired: 4, value: 'Amiri Quran', style: 'font-family: \'Amiri Quran\', serif;' },
    { id: 'font-lateef', type: 'font', name: 'Ø®Ø· Ù„Ø·ÙŠÙ', cost: 900, levelRequired: 5, value: 'Lateef', style: 'font-family: \'Lateef\', serif;' },
    { id: 'font-reemkufiink', type: 'font', name: 'Ø®Ø· Ø±ÙŠÙ… ÙƒÙˆÙÙŠ', cost: 1000, levelRequired: 5, value: 'Reem Kufi Ink', style: 'font-family: \'Reem Kufi Ink\', sans-serif;' },
    { id: 'font-arefruqaa', type: 'font', name: 'Ø¹Ø§Ø±Ù Ø±Ù‚Ø¹Ø©', cost: 1100, levelRequired: 6, value: 'Aref Ruqaa', style: 'font-family: \'Aref Ruqaa\', serif;' },
    { id: 'font-katibeh', type: 'font', name: 'ÙƒØ§ØªØ¨Ù‡', cost: 1200, levelRequired: 6, value: 'Katibeh', style: 'font-family: \'Katibeh\', serif;' },
    { id: 'font-marhey', type: 'font', name: 'Ù…Ø±Ø­ÙŠ', cost: 1300, levelRequired: 7, value: 'Marhey', style: 'font-family: \'Marhey\', sans-serif;' },

    // Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø±ÙŠØ· (Ø£Ù„ÙˆØ§Ù† ÙˆØ£Ø´ÙƒØ§Ù„)
    { id: 'banner-style-blue-solid', type: 'banner_style', name: 'Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ', cost: 800, levelRequired: 2, value: '#007bff', preview: 'background-color: #007bff;', class: '' },
    { id: 'banner-style-purple-gradient', type: 'banner_style', name: 'ØªØ¯Ø±Ø¬ Ø¨Ù†ÙØ³Ø¬ÙŠ', cost: 1200, levelRequired: 3, value: 'linear-gradient(to top, #6A11CB 50%, rgba(106,17,203,0.7) 75%, rgba(106,17,203,0.0) 100%)', preview: 'background: linear-gradient(to top, #6A11CB, #4A0F8A);', class: '' },
    { id: 'banner-style-green-wave', type: 'banner_style', name: 'Ù…ÙˆØ¬Ø© Ø®Ø¶Ø±Ø§Ø¡', cost: 1800, levelRequired: 4, value: 'linear-gradient(to top, #28a745 50%, rgba(40,167,69,0.7) 75%, rgba(40,167,69,0.0) 100%)', preview: 'background: linear-gradient(to top, #28a745, #1E7E34);', class: '' },
    { id: 'banner-style-rounded-bottom', type: 'banner_style', name: 'Ø­ÙˆØ§Ù Ø³ÙÙ„ÙŠØ© Ø¯Ø§Ø¦Ø±ÙŠØ©', cost: 1000, levelRequired: 3, value: null, preview: 'background-color: #F44336; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;', class: 'rounded-bottom-banner' },
    { id: 'banner-style-dark-blue-gradient', type: 'banner_style', name: 'ØªØ¯Ø±Ø¬ Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ†', cost: 1500, levelRequired: 4, value: 'linear-gradient(to top, #153243 50%, rgba(21,50,67,0.7) 75%, rgba(21,50,67,0.0) 100%)', preview: 'background: linear-gradient(to top, #153243, #0A1C2C);', class: '' },

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ
    { id: 'text-effect-outline-white', type: 'text_effect', name: 'Ø¥Ø·Ø§Ø± Ø£Ø¨ÙŠØ¶', cost: 700, levelRequired: 2, value: '-webkit-text-stroke: 1.5px white; text-stroke: 1.5px white;', preview: 'font-size: 1.5em; -webkit-text-stroke: 1.5px white; text-stroke: 1.5px white; color: black; background-color: #eee; border-radius: 5px;' },
    { id: 'text-effect-outline-black', type: 'text_effect', name: 'Ø¥Ø·Ø§Ø± Ø£Ø³ÙˆØ¯', cost: 700, levelRequired: 2, value: '-webkit-text-stroke: 1.5px black; text-stroke: 1.5px black;', preview: 'font-size: 1.5em; -webkit-text-stroke: 1.5px black; text-stroke: 1.5px black; color: white; background-color: #222; border-radius: 5px;' },
    { id: 'text-effect-glow', type: 'text_effect', name: 'ØªÙˆÙ‡Ø¬', cost: 900, levelRequired: 3, value: 'text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #FFC107;', preview: 'font-size: 1.5em; text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #FFC107; background-color: #3A3A5A; border-radius: 5px;' },
    { id: 'text-effect-neon', type: 'text_effect', name: 'Ù†ÙŠÙˆÙ†', cost: 1500, levelRequired: 4, value: 'text-shadow: 0 0 7px #0ff, 0 0 10px #0ff, 0 0 21px #0ff, 0 0 42px #0fa, 0 0 82px #0fa, 0 0 92px #0fa, 0 0 102px #0fa, 0 0 151px #0fa;', preview: 'font-size: 1.5em; text-shadow: 0 0 7px #0ff; background-color: #3A3A5A; border-radius: 5px;' },


    // Ø£Ø­Ø¬Ø§Ù… ÙˆØªØ¹Ø¯ÙŠÙ„Ø§Øª
    { id: 'size-banner-boost', type: 'size_boost', name: 'Ø§Ø±ØªÙØ§Ø¹ Ø´Ø±ÙŠØ· Ø¥Ø¶Ø§ÙÙŠ', cost: 1500, levelRequired: 4, value: { target: 'bannerHeight', max: 150 }, description: 'ÙŠØ²ÙŠØ¯ Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„Ø´Ø±ÙŠØ· Ø¥Ù„Ù‰ 150 Ø¨ÙƒØ³Ù„.' },
    { id: 'size-text-boost', type: 'size_boost', name: 'Ø­Ø¬Ù… Ù†Øµ Ø£ÙƒØ¨Ø±', cost: 1200, levelRequired: 3, value: { target: 'fontSize', max: 2.5 }, description: 'ÙŠØ²ÙŠØ¯ Ø£Ù‚ØµÙ‰ Ø­Ø¬Ù… Ù„Ù„Ø®Ø· Ø¥Ù„Ù‰ 2.5em.' },

    // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG Ø¨Ø³ÙŠØ·Ø© ÙƒÙ€ Data URLs)
    { id: 'icon-custom', type: 'icon', name: 'ØµÙˆØ±Ø© Ù…Ø®ØµØµØ©', cost: 500, levelRequired: 1, value: 'custom', description: 'ØªØªÙŠØ­ Ù„Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø©.' },
    { id: 'icon-square', type: 'icon', name: 'Ù…Ø±Ø¨Ø¹ â– ', cost: 200, levelRequired: 2, value: 'square' },
    { id: 'icon-circle', type: 'icon', name: 'Ø¯Ø§Ø¦Ø±Ø© â—', cost: 250, levelRequired: 2, value: 'circle' },
    { id: 'icon-triangle', type: 'icon', name: 'Ù…Ø«Ù„Ø« â–²', cost: 300, levelRequired: 2, value: 'triangle' },
    { id: 'icon-star', type: 'icon', name: 'Ù†Ø¬Ù…Ø© â˜…', cost: 400, levelRequired: 3, value: 'star' },
    { id: 'icon-broadcast', type: 'icon', name: 'Ø¨Ø« ğŸ“¡', cost: 500, levelRequired: 3, value: 'broadcast' },
    { id: 'icon-check', type: 'icon', name: 'Ø£ÙŠÙ‚ÙˆÙ†Ø© ØµØ­', cost: 600, levelRequired: 4, value: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9MTA5IDE2LjE3TDQgMTEuMTcgMi41OCAxMi41OCA5IDE5LjkyIDE5LjQyIDkuNTEgMTggOC4wOUw5IDE2LjE3eiIvPjwvc3ZnPg==' },
    { id: 'icon-message', type: 'icon', name: 'Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø±Ø³Ø§Ù„Ø©', cost: 900, levelRequired: 4, value: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9TTIwIDJINEMyLjkgMiAyIDIuOSAyIDR2MTZjMCAxLjEuOSAyIDIgMi4wMUwyMiAyMC4wMVY0YzAtMS4xLS45LTItMi0yem0wIDE4SDhMNC4wMSAxNlY0aDE1Ljk5VjIzeiIvPjwvc3ZnPg==' },
    { id: 'icon-youtube', type: 'icon', name: 'Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙŠÙˆØªÙŠÙˆØ¨', cost: 700, levelRequired: 5, value: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRiI+PHBhdGggZD0yMCAySDQuMUMzLjUxIDIgMyAyLjUxIDMgNGgzVjJoLTJWOWg0VjIuODhMMjAuMyAyLjU3QzIwLjYyIDIuNDYgMjEgMi44MiAyMSAzLjMxdjguMzhjMCAuNTEtLjQgLjc1LS42NC41OWwtMy4zMy0yLjQydi0xLjY3aC00VjE3hDcuMTZsLTIuMDYgMS40NGMtLjQyLjMxLS43NC43NS0uNzQgMS4zMnYyLjc5Yy40Ni0wLjE2LjgtLjYyLjgzLS45NWwzLjQ1LTIuNDFhMS40ODIgMS40ODIgMCAwIDAgLjc2LTEuMzJWMi43MmMwLTEuMjMtLjkuLTIuMTYtMi4zLTIuMDZsLjA1LS44OXoiLz48L3N2Zz4=' }
  ];

  // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ¸ ---

  function saveGameProgress() {
    localStorage.setItem('totalDinar', totalDinar.toString());
    localStorage.setItem('currentXP', currentXP.toString());
    localStorage.setItem('currentLevel', currentLevel.toString());
    localStorage.setItem('unlockedItems', JSON.stringify(unlockedItems));
    localStorage.setItem('selectedBannerStyle', selectedBannerStyle);
    localStorage.setItem('selectedTextEffect', selectedTextEffect);
    localStorage.setItem('customIconBase64', customIconBase64); // Ø­ÙØ¸ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø®ØµØµØ©

    // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
    localStorage.setItem('mainImageSrc', mainImage.src);
    localStorage.setItem('newText', newTextInput.value);
    localStorage.setItem('fontSelectValue', fontSelect.value);
    localStorage.setItem('fontSizeValue', fontSizeInput.value);
    localStorage.setItem('textColorValue', textColorInput.value);
    localStorage.setItem('redBannerColorValue', redBannerColorInput.value);
    localStorage.setItem('bannerHeightValue', bannerHeightInput.value);
    localStorage.setItem('textPaddingValue', textPaddingInput.value);
    localStorage.setItem('textShadowToggleChecked', textShadowToggle.checked);
    localStorage.setItem('iconTypeSelectValue', iconTypeSelect.value);
    localStorage.setItem('iconColorValue', iconColorInput.value);
    localStorage.setItem('iconSizeValue', iconSizeInput.value);
    localStorage.setItem('iconPositionValue', iconPositionSelect.value);


    updatePlayerStatsDisplay();
  }

  function loadGameProgress() {
    totalDinar = parseInt(localStorage.getItem('totalDinar') || '0');
    currentXP = parseInt(localStorage.getItem('currentXP') || '0');
    currentLevel = parseInt(localStorage.getItem('currentLevel') || '1');
    unlockedItems = JSON.parse(localStorage.getItem('unlockedItems') || '[]');
    selectedBannerStyle = localStorage.getItem('selectedBannerStyle') || 'default_red';
    selectedTextEffect = localStorage.getItem('selectedTextEffect') || 'none';
    customIconBase64 = localStorage.getItem('customIconBase64') || null;

    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ±
    if (localStorage.getItem('mainImageSrc')) mainImage.src = localStorage.getItem('mainImageSrc');
    if (localStorage.getItem('newText')) newTextInput.value = localStorage.getItem('newText');
    if (localStorage.getItem('fontSelectValue')) fontSelect.value = localStorage.getItem('fontSelectValue');
    if (localStorage.getItem('fontSizeValue')) fontSizeInput.value = localStorage.getItem('fontSizeValue');
    if (localStorage.getItem('textColorValue')) textColorInput.value = localStorage.getItem('textColorValue');
    if (localStorage.getItem('redBannerColorValue')) redBannerColorInput.value = localStorage.getItem('redBannerColorValue');
    if (localStorage.getItem('bannerHeightValue')) bannerHeightInput.value = localStorage.getItem('bannerHeightValue');
    if (localStorage.getItem('textPaddingValue')) textPaddingInput.value = localStorage.getItem('textPaddingValue');
    if (localStorage.getItem('textShadowToggleChecked')) textShadowToggle.checked = (localStorage.getItem('textShadowToggleChecked') === 'true');
    if (localStorage.getItem('iconTypeSelectValue')) iconTypeSelect.value = localStorage.getItem('iconTypeSelectValue');
    if (localStorage.getItem('iconColorValue')) iconColorInput.value = localStorage.getItem('iconColorValue');
    if (localStorage.getItem('iconSizeValue')) iconSizeInput.value = localStorage.getItem('iconSizeValue');
    if (localStorage.getItem('iconPositionValue')) iconPositionSelect.value = localStorage.getItem('iconPositionValue');
  }


  function updatePlayerStatsDisplay() {
    dinarDisplay.textContent = totalDinar;
    levelDisplay.textContent = currentLevel;

    const xpForNextLevel = currentLevel * XP_TO_LEVEL_UP_BASE;
    xpRemainingDisplay.textContent = `${currentXP} / ${xpForNextLevel} XP`;
  }

  function checkLevelUp() {
    const xpForNextLevel = currentLevel * XP_TO_LEVEL_UP_BASE;
    if (currentXP >= xpForNextLevel) {
      currentLevel++;
      // Ù„Ø§ ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† XPØŒ Ø¨Ù„ ØªØ³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ±Ø§ÙƒÙ… (ØªØµØ§Ø¹Ø¯ÙŠ)
      showNotification(`ğŸ‰ Ù„Ù‚Ø¯ Ø§Ø±ØªÙØ¹Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}!`, 'success');
      checkLevelUp(); // Recursive call for multiple level ups
    }
    saveGameProgress();
    renderStore(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø± Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙØªÙˆØ­Ø©
    updateAvailableOptions(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
  }

  function addRandomCurrencyAndXP() {
    const dinarToAdd = Math.floor(Math.random() * 5) + 1; // Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 1 Ùˆ 5
    const xpToAdd = Math.floor(Math.random() * 7) + 1; // XP Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 1 Ùˆ 7

    totalDinar += dinarToAdd;
    currentXP += xpToAdd;

    checkLevelUp(); // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø±ØªÙ‚Ø§Ø¡ Ø¨Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¨Ø±Ø©
    updatePlayerStatsDisplay(); // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ø¹Ø±Ø¶
  }

  // Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆØ§Ù„Ø®Ø¨Ø±Ø© ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù
  setInterval(addRandomCurrencyAndXP, 5000);

  // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØªØ¬Ø± ---

  function isItemUnlocked(itemId) {
    return unlockedItems.includes(itemId);
  }

  function renderStore() {
    storeFontsGrid.innerHTML = '';
    storeBannerStylesGrid.innerHTML = '';
    storeTextEffectsGrid.innerHTML = '';
    storeSizesGrid.innerHTML = '';
    storeIconsGrid.innerHTML = '';

    storeItemsData.forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.classList.add('store-item');
      itemElement.dataset.itemId = item.id;

      const unlocked = isItemUnlocked(item.id);
      const canAfford = totalDinar >= item.cost;
      const levelMet = currentLevel >= item.levelRequired;
      const isLockedByLevel = !levelMet;

      if (unlocked) {
          itemElement.classList.add('unlocked');
      } else if (isLockedByLevel) {
          itemElement.classList.add('locked');
      }

      let previewContent = '';
      if (item.type === 'font') {
          previewContent = `<span style="${item.style}">Ù†Ù…ÙˆØ°Ø¬</span>`;
      } else if (item.type === 'banner_style') {
          previewContent = `<div class="store-item-preview banner-preview ${item.class || ''}" style="${item.preview}">Ø´Ø±ÙŠØ·</div>`;
      } else if (item.type === 'text_effect') {
          previewContent = `<span class="store-item-preview text-effect-preview" style="${item.preview}">Ù†Øµ</span>`;
      } else if (item.type === 'icon') {
          if (item.value.startsWith('data:image/svg+xml')) {
              previewContent = `<img src="${item.value}" alt="Ø£ÙŠÙ‚ÙˆÙ†Ø©" style="height: 40px; width: auto; filter: invert(100%);">`;
          } else if (item.value === 'custom') {
              previewContent = `<span class="icon">ğŸ–¼ï¸</span>`;
          }
          else {
              let iconChar = '';
              switch (item.value) {
                  case 'square': iconChar = 'â– '; break;
                  case 'circle': iconChar = 'â—'; break;
                  case 'triangle': iconChar = 'â–²'; break;
                  case 'star': iconChar = 'â˜…'; break;
                  case 'broadcast': iconChar = 'ğŸ“¡'; break;
              }
              previewContent = `<span style="font-size: 1.5em; color: var(--text-light);">${iconChar}</span>`;
          }
      } else if (item.type === 'size_boost') {
          previewContent = `<span class="icon">â¬†ï¸</span>`;
      }


      itemElement.innerHTML = `
          ${isLockedByLevel ? `<div class="locked-overlay">ğŸ”’<br><span>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${item.levelRequired} Ù…Ø·Ù„ÙˆØ¨</span></div>` : ''}
          <div class="store-item-name">${item.name}</div>
          <div class="store-item-preview">${previewContent}</div>
          <div class="store-item-details">
              <span>Ø§Ù„ØªÙƒÙ„ÙØ©: ${item.cost} Ø¯ÙŠÙ†Ø§Ø±</span>
              <span>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${item.levelRequired}</span>
              ${item.description ? `<span>${item.description}</span>` : ''}
          </div>
          <button class="buy-button" ${unlocked || !canAfford || isLockedByLevel ? 'disabled' : ''}>
              ${unlocked ? 'ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡' : `Ø´Ø±Ø§Ø¡ (${item.cost})`}
          </button>
      `;

      if (!unlocked) {
        const buyButton = itemElement.querySelector('.buy-button');
        buyButton.addEventListener('click', () => buyItem(item.id));
      }


      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„ØµØ­ÙŠØ­Ø©
      if (item.type === 'font') {
        storeFontsGrid.appendChild(itemElement);
      } else if (item.type === 'banner_style') {
        storeBannerStylesGrid.appendChild(itemElement);
      } else if (item.type === 'text_effect') {
        storeTextEffectsGrid.appendChild(itemElement);
      } else if (item.type === 'size_boost') {
        storeSizesGrid.appendChild(itemElement);
      } else if (item.type === 'icon') {
        storeIconsGrid.appendChild(itemElement);
      }
    });
  }

  function buyItem(itemId) {
    const item = storeItemsData.find(i => i.id === itemId);

    if (!item) {
      showNotification('Ø§Ù„Ø¹Ù†ØµØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.', 'error');
      return;
    }

    if (isItemUnlocked(itemId)) {
      showNotification('Ù„Ù‚Ø¯ Ø§Ø´ØªØ±ÙŠØª Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ø§Ù„ÙØ¹Ù„!', 'info');
      return;
    }

    if (currentLevel < item.levelRequired) {
      showNotification(`ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${item.levelRequired} Ù„Ø´Ø±Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±.`, 'error');
      return;
    }

    if (totalDinar < item.cost) {
      showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø¯ÙŠÙ†Ø§Ø± ÙƒØ§ÙÙŠØ© Ù„Ø´Ø±Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±.', 'error');
      return;
    }

    // Ø®ØµÙ… Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙØªÙˆØ­Ø©
    totalDinar -= item.cost;
    unlockedItems.push(itemId);
    saveGameProgress();
    showNotification(`Ù„Ù‚Ø¯ Ø§Ø´ØªØ±ÙŠØª ${item.name} Ø¨Ù†Ø¬Ø§Ø­!`, 'success');

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø´ØªØ±Ø§Ø©
    applyUnlockedItem(item);
    renderStore(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø± Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ±
    updateAvailableOptions(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
  }

  function applyUnlockedItem(item) {
    if (item.type === 'size_boost') {
        if (item.value.target === 'bannerHeight') {
            bannerHeightInput.max = item.value.max;
            showNotification(`ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· Ø¥Ù„Ù‰ ${item.value.max}px.`, 'info');
        } else if (item.value.target === 'fontSize') {
            fontSizeInput.max = item.value.max;
            showNotification(`ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø¥Ù„Ù‰ ${item.value.max}em.`, 'info');
        }
    }
  }

  function updateAvailableOptions() {
    // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ø·ÙˆØ·
    const currentFontValue = fontSelect.value;
    fontSelect.innerHTML = ''; // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ (Ø®Ø· Ø§Ù„Ù†Ø¸Ø§Ù…)
    const defaultFontOption = document.createElement('option');
    defaultFontOption.value = 'system-ui';
    defaultFontOption.textContent = 'Ø§ÙØªØ±Ø§Ø¶ÙŠ (System UI)';
    defaultFontOption.style.fontFamily = 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif';
    defaultFontOption.dataset.isFree = 'true';
    fontSelect.appendChild(defaultFontOption);

    // Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ù…Ø¬Ø§Ù†ÙŠÙ‹Ø§
    const cairoFontOption = document.createElement('option');
    cairoFontOption.value = 'Cairo';
    cairoFontOption.textContent = 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (Cairo)';
    cairoFontOption.style.fontFamily = 'Cairo, sans-serif';
    cairoFontOption.dataset.isFree = 'true';
    fontSelect.appendChild(cairoFontOption);

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø´ØªØ±Ø§Ø©
    storeItemsData.filter(item => item.type === 'font' && isItemUnlocked(item.id)).forEach(item => {
        const option = document.createElement('option');
        option.value = item.value;
        option.textContent = item.name;
        option.style = item.style;
        fontSelect.appendChild(option);
    });
    fontSelect.value = currentFontValue; // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©

    // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
    const currentIconValue = iconTypeSelect.value;
    iconTypeSelect.innerHTML = ''; // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª

    const noneIconOption = document.createElement('option');
    noneIconOption.value = 'none';
    noneIconOption.textContent = 'Ù„Ø§ Ø´ÙŠØ¡';
    noneIconOption.dataset.isFree = 'true';
    iconTypeSelect.appendChild(noneIconOption);

    storeItemsData.filter(item => item.type === 'icon' && isItemUnlocked(item.id)).forEach(item => {
        const option = document.createElement('option');
        option.value = item.id;
        option.textContent = item.name;
        iconTypeSelect.appendChild(option);
    });
    iconTypeSelect.value = currentIconValue;


    // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø±ÙŠØ·
    const currentBannerStyleValue = bannerStyleSelect.value;
    bannerStyleSelect.innerHTML = '';

    const defaultRedOption = document.createElement('option');
    defaultRedOption.value = 'default_red';
    defaultRedOption.textContent = 'Ø£Ø­Ù…Ø± (Ø§ÙØªØ±Ø§Ø¶ÙŠ)';
    defaultRedOption.dataset.isFree = 'true';
    bannerStyleSelect.appendChild(defaultRedOption);

    storeItemsData.filter(item => item.type === 'banner_style' && isItemUnlocked(item.id)).forEach(item => {
        const option = document.createElement('option');
        option.value = item.id;
        option.textContent = item.name;
        bannerStyleSelect.appendChild(option);
    });
    bannerStyleSelect.value = currentBannerStyleValue;


    // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ
    const currentTextEffectValue = textEffectSelect.value;
    textEffectSelect.innerHTML = '';

    const noneTextEffectOption = document.createElement('option');
    noneTextEffectOption.value = 'none';
    noneTextEffectOption.textContent = 'Ù„Ø§ Ø´ÙŠØ¡';
    noneTextEffectOption.dataset.isFree = 'true';
    textEffectSelect.appendChild(noneTextEffectOption);

    storeItemsData.filter(item => item.type === 'text_effect' && isItemUnlocked(item.id)).forEach(item => {
        const option = document.createElement('option');
        option.value = item.id;
        option.textContent = item.name;
        textEffectSelect.appendChild(option);
    });
    textEffectSelect.value = currentTextEffectValue;

    // ØªØ·Ø¨ÙŠÙ‚ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ù…ÙØªÙˆØ­Ø© (ØªØºÙŠÙŠØ± Ø§Ù„Ù€ max Ù„Ù„Ù€ sliders)
    storeItemsData.filter(item => item.type === 'size_boost' && isItemUnlocked(item.id)).forEach(item => {
        applyUnlockedItem(item); // Re-apply to set max values correctly
    });

    // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    applyCurrentFont();
    applyCurrentBannerStyle();
    applyCurrentTextEffect();
    updateIcons();
  }


  // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ---
  function showNotification(message, type = 'info', duration = 3000) {
    const notificationDiv = document.createElement('div');
    notificationDiv.classList.add('notification', type);
    notificationDiv.innerHTML = `<span class="icon">${getNotificationIcon(type)}</span> ${message}`;
    notificationArea.appendChild(notificationDiv);

    setTimeout(() => {
      notificationDiv.classList.add('show');
    }, 10);

    setTimeout(() => {
      notificationDiv.classList.remove('show');
      notificationDiv.addEventListener('transitionend', () => notificationDiv.remove());
    }, duration);
  }

  function getNotificationIcon(type) {
    switch (type) {
      case 'success': return 'âœ…';
      case 'error': return 'âŒ';
      case 'info': return 'â„¹ï¸';
      default: return '';
    }
  }


  // --- Ø¯ÙˆØ§Ù„ Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ ---

  function applyCurrentFont() {
      const selectedFontValue = fontSelect.value;
      if(selectedFontValue === 'system-ui') {
          mainText.style.fontFamily = 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif';
      } else if (selectedFontValue === 'Cairo') {
          mainText.style.fontFamily = 'Cairo, sans-serif';
      } else {
          const selectedFontItem = storeItemsData.find(item => item.type === 'font' && item.value === selectedFontValue);
          if (selectedFontItem && isItemUnlocked(selectedFontItem.id)) {
            mainText.style.fontFamily = selectedFontItem.style.replace('font-family: ', '').replace(';', '');
          }
      }
  }

  function applyCurrentBannerStyle() {
    const bannerStyleId = bannerStyleSelect.value;
    const bannerStyleItem = storeItemsData.find(item => item.type === 'banner_style' && item.id === bannerStyleId);

    redBanner.classList.remove('rounded-bottom-banner'); // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ÙØ¦Ø§Øª Ø³Ø§Ø¨Ù‚Ø©

    if (bannerStyleId === 'default_red') {
        redBannerColorInputGroup.style.display = 'flex'; // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¯Ø®Ù„ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±
        const hexToRgb = hex => {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r},${g},${b}`;
        };
        const rgbColor = hexToRgb(redBannerColorInput.value);
        redBanner.style.background = `linear-gradient(to top, ${redBannerColorInput.value} 50%, rgba(${rgbColor}, 0.7) 75%, rgba(${rgbColor}, 0.0) 100%)`;
    } else if (bannerStyleItem && isItemUnlocked(bannerStyleItem.id)) {
        redBannerColorInputGroup.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¯Ø®Ù„ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±
        if (bannerStyleItem.value) { // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù…Ø· Ù‡Ùˆ Ù„ÙˆÙ† Ø£Ùˆ ØªØ¯Ø±Ø¬
            redBanner.style.background = bannerStyleItem.value;
        } else { // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù…Ø· ÙŠØªØ¹Ù„Ù‚ Ø¨Ø´ÙƒÙ„ (Ù…Ø«Ù„ Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ©)
            redBanner.style.background = `linear-gradient(to top, var(--accent-color) 50%, rgba(244,67,54,0.7) 75%, rgba(244,67,54,0.0) 100%)`; // Ù„ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù‚ÙŠÙ…Ø©
        }
        if (bannerStyleItem.class) {
            redBanner.classList.add(bannerStyleItem.class);
        }
    } else { // Ø­Ø§Ù„Ø© Ù„Ù… ÙŠØªÙ… Ø´Ø±Ø§Ø¡ Ø§Ù„Ù†Ù…Ø· Ø£Ùˆ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡
        redBannerColorInputGroup.style.display = 'flex';
        redBannerColorInput.value = "#F44336"; // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const hexToRgb = hex => {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r},${g},${b}`;
        };
        const rgbColor = hexToRgb(redBannerColorInput.value);
        redBanner.style.background = `linear-gradient(to top, ${redBannerColorInput.value} 50%, rgba(${rgbColor}, 0.7) 75%, rgba(${rgbColor}, 0.0) 100%)`;
        bannerStyleSelect.value = 'default_red'; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    }
    saveGameProgress(); // Save the selected style
  }

  function applyCurrentTextEffect() {
    const textEffectId = textEffectSelect.value;
    const textEffectItem = storeItemsData.find(item => item.type === 'text_effect' && item.id === textEffectId);

    mainText.style.textShadow = textShadowToggle.checked ? '1px 1px 3px rgba(0,0,0,0.5)' : 'none';
    mainText.style.webkitTextStroke = 'none';
    mainText.style.textStroke = 'none';

    if (textEffectId === 'none') {
        // Shadow is handled by the toggle directly
    } else if (textEffectItem && isItemUnlocked(textEffectItem.id)) {
        // Apply the effect. Handle text-shadow and text-stroke separately
        if (textEffectItem.value.includes('text-shadow')) {
            mainText.style.textShadow = textEffectItem.value.split('text-shadow: ')[1].split(';')[0];
        }
        if (textEffectItem.value.includes('-webkit-text-stroke')) {
            mainText.style.webkitTextStroke = textEffectItem.value.split('-webkit-text-stroke: ')[1].split(';')[0];
            mainText.style.textStroke = mainText.style.webkitTextStroke; // Fallback for standard
        }
    }
    saveGameProgress(); // Save the selected effect
  }


  // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª (ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡Ø§ Ù„Ù„Ø­Ø¬Ù… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ)
  function updateIcons() {
      const iconType = iconTypeSelect.value;
      const iconColor = iconColorInput.value;
      const iconSizeMultiplier = parseFloat(iconSizeInput.value);

      const mainTextComputedStyle = window.getComputedStyle(mainText);
      const mainTextFontSizePx = parseFloat(mainTextComputedStyle.fontSize);
      const baseIconFactorOfText = 1.2;
      const currentIconPxHeight = iconSizeMultiplier * mainTextFontSizePx * baseIconFactorOfText;

      channelIconsContainer.innerHTML = '';

      const storeIcon = storeItemsData.find(item => item.id === iconType && item.type === 'icon');

      const isCustomIconSelected = (iconType === 'icon-custom' && isItemUnlocked('icon-custom'));

      customIconUploadGroup.style.display = isCustomIconSelected ? 'flex' : 'none';
      iconColorAndSizeGroup.style.display = (iconType !== 'none' && !isCustomIconSelected) ? 'flex' : 'none';
      iconSizeGroup.style.display = (iconType !== 'none') ? 'flex' : 'none';


      if (isCustomIconSelected) {
          if (customIconBase64) {
              const img = document.createElement('img');
              img.src = customIconBase64;
              img.style.height = `${currentIconPxHeight}px`;
              img.style.width = 'auto';
              channelIconsContainer.appendChild(img);
          }
      } else if (storeIcon && isItemUnlocked(storeIcon.id)) {
          if (storeIcon.value.startsWith('data:image/svg+xml')) {
              const img = document.createElement('img');
              img.src = storeIcon.value;
              img.style.height = `${currentIconPxHeight}px`;
              img.style.width = 'auto';
              img.style.filter = `invert(100%) saturate(100%) hue-rotate(90deg) brightness(1.5) contrast(1.5)`;
              channelIconsContainer.appendChild(img);
          } else {
              let iconChar = '';
              switch (storeIcon.value) {
                  case 'square': iconChar = 'â– '; break;
                  case 'circle': iconChar = 'â—'; break;
                  case 'triangle': iconChar = 'â–²'; break;
                  case 'star': iconChar = 'â˜…'; break;
                  case 'broadcast': iconChar = 'ğŸ“¡'; break;
              }
              const span = document.createElement('span');
              span.style.color = iconColor;
              span.style.fontSize = `${currentIconPxHeight}px`;
              span.textContent = iconChar;
              channelIconsContainer.appendChild(span);
          }
      }

      iconSizeValueDisplay.textContent = `${currentIconPxHeight.toFixed(0)}px`;

      redBanner.style.justifyContent = iconPositionSelect.value;
      if (iconPositionSelect.value === 'flex-start') {
          channelIconsContainer.style.order = 1;
          mainText.style.order = 2;
      } else if (iconPositionSelect.value === 'flex-end') {
          channelIconsContainer.style.order = 2;
          mainText.style.order = 1;
      } else {
          channelIconsContainer.style.order = 1;
          mainText.style.order = 2;
      }

      if (channelIconsContainer.children.length > 0) {
          mainText.style.width = 'auto';
          mainText.style.flexShrink = '1';
          mainText.style.flexGrow = '1';
      } else {
          mainText.style.width = '100%';
          mainText.style.flexShrink = '0';
          mainText.style.flexGrow = '0';
      }
      saveGameProgress(); // Save icon settings
  }


  function updateText() {
    let currentRawText = newTextInput.value;

    const currentChars = currentRawText.length;
    const currentWords = currentRawText.split(/\s+/).filter(word => word.length > 0).length;

    if (currentChars > maxCharLength) {
        currentRawText = currentRawText.substring(0, maxCharLength);
        newTextInput.value = currentRawText;
    }

    const remainingChars = maxCharLength - currentRawText.length;
    charCountDisplay.textContent = `Ø§Ù„Ø£Ø­Ø±Ù: ${currentRawText.length} / ${maxCharLength}`;
    wordCountDisplay.textContent = `Ø§Ù„ÙƒÙ„Ù…Ø§Øª: ${currentWords}`;

    charCountDisplay.classList.remove('warning', 'danger');
    if (remainingChars <= 15 && remainingChars > 0) {
        charCountDisplay.classList.add('warning');
    } else if (remainingChars <= 0) {
        charCountDisplay.classList.add('danger');
        charCountDisplay.textContent = `Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£Ø­Ø±Ù!`;
    }

    mainText.innerHTML = currentRawText;
    updateIcons();
    saveGameProgress();
  }


  // --- Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Event Listeners) ---

  fontSelect.addEventListener('change', function() {
      applyCurrentFont();
      updateIcons(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ø·
      saveGameProgress();
  });

  fontSizeInput.addEventListener('input', function() {
      mainText.style.fontSize = this.value + 'em';
      fontSizeValueDisplay.textContent = this.value + 'em';
      updateIcons(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
      saveGameProgress();
  });

  textColorInput.addEventListener('input', function() {
      mainText.style.color = this.value;
      saveGameProgress();
  });

  redBannerColorInput.addEventListener('input', function() {
      applyCurrentBannerStyle(); // Ø³ØªÙ‚ÙˆÙ… Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù‡Ùˆ Ø§Ù„Ù…Ø­Ø¯Ø¯
      saveGameProgress();
  });

  textShadowToggle.addEventListener('change', function() {
      applyCurrentTextEffect(); // Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¸Ù„ Ø£Ùˆ Ø¥Ø²Ø§Ù„ØªÙ‡ ÙƒØ¬Ø²Ø¡ Ù…Ù† ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ
      saveGameProgress();
  });

  // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
  iconTypeSelect.addEventListener('change', updateIcons);
  iconColorInput.addEventListener('input', updateIcons);
  iconSizeInput.addEventListener('input', updateIcons);
  iconPositionSelect.addEventListener('change', updateIcons);

  // Ù…Ø¹Ø§Ù„Ø¬ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø®ØµØµØ©
  customIconUploadInput.addEventListener('change', function(event) {
      const file = event.target.files && event.target.files.length > 0 ? event.target.files[0] : null;
      if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
              customIconBase64 = e.target.result;
              updateIcons();
              saveGameProgress();
          };
          reader.readAsDataURL(file);
      } else {
          customIconBase64 = null;
          updateIcons();
          saveGameProgress();
      }
  });

  // Ù…Ø¹Ø§Ù„Ø¬ Ø²Ø± Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø®ØµØµØ©
  removeCustomIconButton.addEventListener('click', function() {
      customIconBase64 = null;
      customIconUploadInput.value = '';
      iconTypeSelect.value = 'none';
      updateIcons();
      saveGameProgress();
  });


  imageUploadInput.addEventListener('change', function(event) {
    const file = event.target.files && event.target.files.length > 0 ? event.target.files [0] : null;

    if (file) {
      const reader = new FileReader();

      reader.onload = function(e) {
        mainImage.src = e.target.result;
        saveGameProgress();
      };

      reader.readAsDataURL(file);
    } else {
      mainImage.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";
      saveGameProgress();
    }
  });

  newTextInput.addEventListener('input', updateText);

  // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ù…Ø±)
  bannerHeightInput.addEventListener('input', function() {
      redBanner.style.minHeight = `${this.value}px`;
      bannerHeightValueDisplay.textContent = `${this.value}px`;
      saveGameProgress();
  });

  textPaddingInput.addEventListener('input', function() {
      redBanner.style.padding = `${this.value}px 25px`;
      textPaddingValueDisplay.textContent = `${this.value}px`;
      saveGameProgress();
  });

  bannerStyleSelect.addEventListener('change', function() {
      selectedBannerStyle = this.value;
      applyCurrentBannerStyle();
      saveGameProgress();
  });

  textEffectSelect.addEventListener('change', function() {
      selectedTextEffect = this.value;
      applyCurrentTextEffect();
      saveGameProgress();
  });


  // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø£Ø²Ø±Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù„ØªØ´Ù…Ù„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø®ØµØµØ©
  document.querySelectorAll('.file-input-wrapper .file-input-button').forEach(button => {
    button.addEventListener('click', function() {
      this.parentNode.querySelector('input[type="file"]').click();
    });
  });


  tabButtons.forEach(button => {
      button.addEventListener('click', () => {
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));

          const targetTab = button.dataset.tab;
          document.getElementById(`${targetTab}TabContent`).classList.add('active');
          button.classList.add('active');

          if (targetTab === 'store') {
            renderStore(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„ÙŠÙ‡
          }
      });
  });

  // Ø¯Ø§Ù„Ø© Ù„Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© ÙˆØªØ­Ù…ÙŠÙ„Ù‡Ø§
  function captureAndProcessImage() {
    const container = document.querySelector('.container');

    if (typeof html2canvas === 'undefined') {
      showNotification('ØªØ¹Ø°Ø± Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©. Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¹Ø±Ø¶ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©.', 'error');
      return;
    }

    viewScreenshotBtn.disabled = true;
    viewScreenshotBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...';

    html2canvas(container, {
      allowTaint: true,
      useCORS: true,
      backgroundColor: null,
      scale: 3
    }).then(canvas => {
      const imgData = canvas.toDataURL('image/png');
      const newWindow = window.open();
      newWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>ØµÙˆØ±Ø© Ø§Ù„Ø®Ø¨Ø± Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©</title>
          <style>
            body {
              margin: 0;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              min-height: 100vh;
              background-color: #1A1A2E;
              padding: 20px;
              box-sizing: border-box;
              overflow: auto;
              color: white;
              font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            }
            img {
              display: block;
              max-width: 95vw;
              max-height: 80vh; /* Ù…Ø³Ø§Ø­Ø© Ù„Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
              object-fit: contain;
              box-shadow: 0 0 15px rgba(0,0,0,0.5);
              border-radius: 0;
              margin-bottom: 20px;
            }
            .download-btn {
              background-color: #28a745;
              color: white;
              padding: 15px 30px;
              border: none;
              border-radius: 10px;
              cursor: pointer;
              font-size: 1.1em;
              font-weight: bold;
              text-decoration: none;
              display: inline-flex;
              align-items: center;
              gap: 10px;
            }
            .download-btn:hover {
              background-color: #218838;
            }
          </style>
        </head>
        <body>
          <img src="${imgData}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø®Ø¨Ø±">
          <a href="${imgData}" download="news_banner_${new Date().getTime()}.png" class="download-btn">
            â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
          </a>
        </body>
        </html>
      `);
      newWindow.document.close();
      showNotification('ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ø¹ Ø®ÙŠØ§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„).', 'info');
      
      viewScreenshotBtn.disabled = false;
      viewScreenshotBtn.innerHTML = '<span class="icon">ğŸ“¸</span> Ø¹Ø±Ø¶ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©';

    }).catch(error => {
      console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Canvas:', error);
      showNotification('ØªØ¹Ø°Ø± Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ ÙˆØ¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø´Ø§ÙƒÙ„.', 'error');
      viewScreenshotBtn.disabled = false;
      viewScreenshotBtn.innerHTML = '<span class="icon">ğŸ“¸</span> Ø¹Ø±Ø¶ Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©';
    });
  }

  viewScreenshotBtn.addEventListener('click', () => captureAndProcessImage());


  // --- Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ---
  function initializeApp() {
    loadGameProgress(); // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©

    newTextInput.value = localStorage.getItem('newText') || defaultText;
    mainText.innerHTML = newTextInput.value;

    textColorInput.value = localStorage.getItem('textColorValue') || "#ffffff";
    mainText.style.color = textColorInput.value;

    redBannerColorInput.value = localStorage.getItem('redBannerColorValue') || "#F44336"; // Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ø¬Ø¯ÙŠØ¯
    bannerHeightInput.value = localStorage.getItem('bannerHeightValue') || "75";
    textPaddingInput.value = localStorage.getItem('textPaddingValue') || "25";
    textShadowToggle.checked = (localStorage.getItem('textShadowToggleChecked') === 'true');


    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§
    mainImage.src = localStorage.getItem('mainImageSrc') || "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";
    mainText.style.fontSize = fontSizeInput.value + 'em';
    fontSizeValueDisplay.textContent = fontSizeInput.value + 'em';
    redBanner.style.minHeight = `${bannerHeightInput.value}px`;
    bannerHeightValueDisplay.textContent = `${bannerHeightInput.value}px`;
    redBanner.style.padding = `${textPaddingInput.value}px 25px`;
    textPaddingValueDisplay.textContent = `${textPaddingInput.value}px`;

    // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹
    updateAvailableOptions();

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    fontSelect.value = localStorage.getItem('fontSelectValue') || 'system-ui';
    iconTypeSelect.value = localStorage.getItem('iconTypeSelectValue') || 'none';
    bannerStyleSelect.value = localStorage.getItem('selectedBannerStyle') || 'default_red';
    textEffectSelect.value = localStorage.getItem('selectedTextEffect') || 'none';
    iconPositionSelect.value = localStorage.getItem('iconPositionValue') || 'center';


    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­Ù…Ù„Ø©
    applyCurrentFont();
    applyCurrentBannerStyle();
    applyCurrentTextEffect();
    updateIcons(); // Ù‡Ø°Ø§ Ø³ÙŠÙ‚ÙˆÙ… Ø£ÙŠØ¶Ù‹Ø§ Ø¨ØªØ­Ø¯ÙŠØ« Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆÙ…ÙˆØ¶Ø¹Ù‡Ø§

    updateText(); // ØªÙ‡ÙŠØ¦Ø© Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Øµ
    updatePlayerStatsDisplay(); // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰
    renderStore(); // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø± Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
  }

  initializeApp();

</script>

</body>
</html>
